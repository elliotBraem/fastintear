{
  "version": 3,
  "sources": ["../../src/adapters/meteor.ts"],
  "sourcesContent": ["import { connect, KeyPair } from \"meer-api-js\";\n\nimport {EMeteorWalletSignInType, MeteorWallet} from \"@fastnear/meteorwallet-sdk\";\nimport { mapActionForWalletSelector } from \"../utils/actionToWalletSelector\";\nimport { PublicKey } from \"@near-js/crypto\";\nimport { keyStores } from \"meer-api-js\";\n\nasync function createMeteorWalletInstance({ networkId = \"mainnet\" }) {\n  const keyStore = new keyStores.BrowserLocalStorageKeyStore(\n    window.localStorage,\n    \"_meteor_wallet\"\n  );\n\n  const near = await connect({\n    keyStore,\n    networkId,\n    nodeUrl:\n      networkId === \"mainnet\"\n        ? \"https://rpc.mainnet.near.org\"\n        : \"https://rpc.testnet.near.org\",\n  });\n\n  return new MeteorWallet({ near, appKeyPrefix: \"near_app\" });\n}\n\nexport function createMeteorAdapter() {\n  return {\n    async signIn({ networkId, contractId, publicKey }) {\n      publicKey = PublicKey.from(publicKey);\n      console.log('aloha publicKey', publicKey)\n      const keyPair = KeyPair.fromString(publicKey.toString());\n      console.log('aloha keyPair', keyPair)\n      const wallet = await createMeteorWalletInstance({ networkId });\n\n      const {\n        success,\n        payload: { accountId },\n      } = await wallet.requestSignIn({\n        contract_id: contractId,\n        type: EMeteorWalletSignInType.ALL_METHODS,\n        keyPair,\n      });\n\n      if (!success) {\n        throw new Error(\"Meteor Wallet sign in failed\");\n      }\n\n      return {\n        state: {\n          accountId,\n          publicKey: publicKey.toString(),\n          networkId,\n        },\n      };\n    },\n\n    async sendTransactions({ state, transactions }) {\n      if (!state?.accountId) {\n        throw new Error(\"Not signed in\");\n      }\n\n      const wallet = await createMeteorWalletInstance({\n        networkId: state?.networkId,\n      });\n      try {\n        const response = await wallet.requestSignTransactions({\n          transactions: transactions.map(\n            ({ signerId, receiverId, actions }) => {\n              if (signerId && signerId !== state.accountId) {\n                throw new Error(\"Invalid signer\");\n              }\n              return {\n                signerId: state.accountId,\n                receiverId,\n                actions: actions.map(mapActionForWalletSelector),\n              };\n            }\n          ),\n        });\n\n        return { outcomes: response };\n      } catch (error) {\n        if (\n          error.message === \"User cancelled the action\" ||\n          error.message ===\n            \"User closed the window before completing the action\"\n        ) {\n          return { rejected: true };\n        }\n        console.log(error);\n        throw new Error(error);\n      }\n    },\n  };\n}\n"],
  "mappings": ";;;;;;AAAA,SAAS,SAAS,eAAe;AAEjC,SAAQ,yBAAyB,oBAAmB;AAEpD,SAAS,iBAAiB;AAC1B,SAAS,iBAAiB;AAE1B,eAAe,2BAA2B,EAAE,YAAY,UAAU,GAAG;AACnE,QAAM,WAAW,IAAI,UAAU;AAAA,IAC7B,OAAO;AAAA,IACP;AAAA,EACF;AAEA,QAAM,OAAO,MAAM,QAAQ;AAAA,IACzB;AAAA,IACA;AAAA,IACA,SACE,cAAc,YACV,iCACA;AAAA,EACR,CAAC;AAED,SAAO,IAAI,aAAa,EAAE,MAAM,cAAc,WAAW,CAAC;AAC5D;AAEO,SAAS,sBAAsB;AACpC,SAAO;AAAA,IACL,MAAM,OAAO,EAAE,WAAW,YAAY,UAAU,GAAG;AACjD,kBAAY,UAAU,KAAK,SAAS;AACpC,cAAQ,IAAI,mBAAmB,SAAS;AACxC,YAAM,UAAU,QAAQ,WAAW,UAAU,SAAS,CAAC;AACvD,cAAQ,IAAI,iBAAiB,OAAO;AACpC,YAAM,SAAS,MAAM,2BAA2B,EAAE,UAAU,CAAC;AAE7D,YAAM;AAAA,QACJ;AAAA,QACA,SAAS,EAAE,UAAU;AAAA,MACvB,IAAI,MAAM,OAAO,cAAc;AAAA,QAC7B,aAAa;AAAA,QACb,MAAM,wBAAwB;AAAA,QAC9B;AAAA,MACF,CAAC;AAED,UAAI,CAAC,SAAS;AACZ,cAAM,IAAI,MAAM,8BAA8B;AAAA,MAChD;AAEA,aAAO;AAAA,QACL,OAAO;AAAA,UACL;AAAA,UACA,WAAW,UAAU,SAAS;AAAA,UAC9B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,IAEA,MAAM,iBAAiB,EAAE,OAAO,aAAa,GAAG;AAC9C,UAAI,CAAC,OAAO,WAAW;AACrB,cAAM,IAAI,MAAM,eAAe;AAAA,MACjC;AAEA,YAAM,SAAS,MAAM,2BAA2B;AAAA,QAC9C,WAAW,OAAO;AAAA,MACpB,CAAC;AACD,UAAI;AACF,cAAM,WAAW,MAAM,OAAO,wBAAwB;AAAA,UACpD,cAAc,aAAa;AAAA,YACzB,CAAC,EAAE,UAAU,YAAY,QAAQ,MAAM;AACrC,kBAAI,YAAY,aAAa,MAAM,WAAW;AAC5C,sBAAM,IAAI,MAAM,gBAAgB;AAAA,cAClC;AACA,qBAAO;AAAA,gBACL,UAAU,MAAM;AAAA,gBAChB;AAAA,gBACA,SAAS,QAAQ,IAAI,0BAA0B;AAAA,cACjD;AAAA,YACF;AAAA,UACF;AAAA,QACF,CAAC;AAED,eAAO,EAAE,UAAU,SAAS;AAAA,MAC9B,SAAS,OAAO;AACd,YACE,MAAM,YAAY,+BAClB,MAAM,YACJ,uDACF;AACA,iBAAO,EAAE,UAAU,KAAK;AAAA,QAC1B;AACA,gBAAQ,IAAI,KAAK;AACjB,cAAM,IAAI,MAAM,KAAK;AAAA,MACvB;AAAA,IACF;AAAA,EACF;AACF;",
  "names": []
}
